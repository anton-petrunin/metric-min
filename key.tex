\section{Key lemma}\label{Key Lemma}


\begin{thm}{Lemma}\label{lem:graph}
Let $Y$ be a $\CAT[0]$ space and $s\:\DD\to Y$ 
be a metric minimizing disc.
Given a finite set $F\subset \DD$ such that $\hat\pi_s(F)$ has finite
diameter in $\<D\>_s$,
there exists a finite piecewise geodesic graph $\Gamma$ embedded in $\<D\>_s$ such that 
$F$ is a subset of its vertexes.
\end{thm} 

\parit{Proof.} 
For any pair $x,y\in F$, connect $\hat x$ to $\hat y$ by a minimizing geodesic in $\<\DD\>_s$. 
We can assume that the constructed geodesics 
are either disjoint or their intersection is formed by finite collections of arcs and points.

Indeed, if some number of geodesics $\gamma_1,\dots,\gamma_n$ already has this property and we are given points $x$ and $y$, then
we choose a minimizing geodesic $\gamma_{n+1}$ from $x$ to $y$ which maximizes the time it spends in $\gamma_1,\dots,\gamma_n$  
in the order of importance.
Namely, 
\begin{itemize}
\item  among all minimizing geodesics connecting $x$ to $y$
choose one which spends maximal time in $\gamma_1$ --- in this case $\gamma_{n+1}$ intersects $\gamma_1$ along the empty set, 
a one-point set or a closed arc.
\item among all minimizing geodesics as above
choose one which spends maximal time in $\gamma_2$ --- in this case $\gamma_{n+1}$ intersects $\gamma_2$ along at most two arcs and points.
\item and so on.
\end{itemize}

It follows that together the constructed geodesics form a finite graph $\Gamma$ as required.
\qeds



\begin{thm}{Key lemma}\label{lem:key}
Let $Y$ be a $\CAT[0]$ space and $s\:\DD\to Y$ 
be a metric minimizing disc.
Given a finite set $F\subset \DD$
there is 
\begin{enumerate}[(1)]
	\item a $\CAT[0]$ disc retract $W$ with boundary curve $\delta$;
	\item a map $p\:F\to W$ such that
\[|p(x)-p(y)|_W\le \<x-y\>_s\] 
for $x,y\in F$ and $p(x)=\delta(x)$ for $x\in F\cap \partial\DD$;
  \item a short map $q\:W\to Y$ such that
\[s(x)=q\circ p(x)\] 
for any $x\in\partial\DD\cap F$.
\end{enumerate}
 
\end{thm} 

\parit{Proof.} If $\partial \DD\cap F= \emptyset$,
then one can take a one-point space as $W$ and arbitrary maps $p\:F\to W$ and $q\:W\to Y$.
So suppose $\partial \DD\cap F\ne\emptyset$.

Without loss of generality we may assume that the distance $\<x-y\>_s$
between any pair of points $x,y\in F$ is finite.
Indeed, since the boundary curve $s|_{\partial\DD}$ is rectifiable,
this always holds for pairs of points in $\partial \DD\cap F$.
Consider the subset $F'\subset F$ which lies at finite $\<{*}-{*}\>_s$-distance from one (and therefore any) point in $\partial \DD\cap F$.
Suppose $p'\:F'\to W$ and $q\:W\to Y$ are maps satisfying the proposition for $F'$.
Extend $p'$ to $F$ by sending $F\backslash F'$ to one point in $W$. The resulting
map $p$ together with $q$ will then satisfy the proposition for $F$.

By Lemma~\ref{lem:graph}, there exists a finite piecewise geodesic graph $\Gamma$ embedded in $<D>_s$ which
contains $F$ as a subset of its vertexes.
According to Proposition~\ref{prop:|D|},
 $\tau_s$ embeds $\Gamma$ in $|\DD|_s$.
By Proposition~\ref{prop:|D|},
$|\DD|_s$ is a disc retract.
Therefore $\Gamma$ can be (and will be) considered as a graph embedded into the plane.

By Proposition~\ref{prop:metric-min-graph-exist}, there is a map 
$u\:\Gamma\to Y$ metric minimizing relative to $A=F\cap\partial\DD$ such that
\[s|_\Gamma\succcurlyeq u\rel A.\eqlbl{eq:>=}\]

Fix an open disc $\Delta$ cut by $\Gamma$ from $|\DD|_s$.
By Reshetnyak's theorem, the closed curve $u|_{\partial\Delta}$
is majorized by a convex plane polygon, possibly degenerate to a point or a line segment.
Note that the angle of the majorizing polygon cannot be smaller than the angle between the corresponding edges in $u(\Gamma)\subset Y$.

Let us glue the majorizing polygons into $\<\Gamma\>_u$;
denote by $W$ the resulting space.
According to Proposition~\ref{prop:metric-min-graph}\ref{sum>=2pi}, the angle around each inner vertex has to be at least $2\cdot\pi$.
Clearly $W$ is a disc retract;
in particular, it is simply connected.
It follows that $W$ is a $\CAT[0]$ space.

The short map $q\:W\to Y$ is constructed by gluing together the maps provided by Reshetnyak's majorization theorem.
The space $W$ comes with a natural short map $\<\Gamma\>_u\to W$.

Define $p(x)$ for $x\in F$ as the image of the corresponding vertex of $\Gamma$ in $W$.
By \ref{eq:>=}, 
\[|p(x)-p(y)|_W\le \<x-y\>_s\]
for any $x,y\in F$.

By construction the pair of maps $p,q$ meet all conditions.
\qeds


The following establishes a connection between the 
key lemma (\ref{lem:key}) and the finite-whole extension lemma (\ref{lem:finite-whole}).

\begin{thm}{Lemma}\label{lem:S-closed}
Let $Y$ be a $\CAT[0]$ space and $s\:\DD\to Y$ 
be a metric minimizing disc. Let $W$ be a
$\CAT[0]$ disc retract with boundary curve $\delta$. For a given 
finite set $F\subset \DD$ we define $\mathfrak{S}_F$ to be the family of maps  
 $p\:F\to W$ such that
\[|p(x)-p(y)|_W\le \<x-y\>_s\] 
for $x,y\in F$ with $p(x)=\delta(x)$ for $x\in F\cap \partial\DD$ and such that there exits
a short map $q\:W\to Y$ with
\[s(x)=q\circ p(x)\] 
for any $x\in\partial\DD\cap F$.
Then $\mathfrak{S}_F$ is closed under pointwise convergence. 
\end{thm}

The proof is an application of the ultralimit+projection construction;
we used it once before and will use it again latter.

\parit{Proof.}
Consider a converging sequence $p_n\in  \mathfrak{S}_F$;
denote by $p_\infty$ its limit.
For each $p_n$ there is a short map $q_n\:W\to Y$ satisfying the condition above.
Pass to its ultralimit $q_\omega\:W\to Y^\omega$.
Recall that $Y$ is a closed convex set in $Y^\omega$.
In particular the closest-point-projection $\nu\:Y^\omega\to Y$ is well defined and short.
Therefore, the composition $q=\nu\circ q_\omega$ is short.
Finally note that the maps $p_\infty\:F\to W$ and $q\:W\to Y$ satisfy the condition above.
\qeds

